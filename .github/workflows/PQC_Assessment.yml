name: Run PQC_Assessment_Tool

on:
  workflow_dispatch: # Allows manual trigger
  push:
    branches:
      - PQC-V2 # Triggers on changes to the PQC-V2 branch

jobs:
  run-pqc-assessment:
    runs-on: self-hosted

    steps:
      # Debug Step 1: Verify the Secret is Accessible
      - name: Debug - Check Secret
        run: |
          if [ -z "${{ secrets.PQC_PAT_TOKEN }}" ]; then
            echo "Error: PQC_PAT_TOKEN secret is missing or empty!"
            exit 1
          else
            echo "PQC_PAT_TOKEN secret is available."
          fi
        shell: bash

      # Debug Step 2: Check Repository Access
      - name: Debug - Check Repository Access
        run: |
          echo "Checking access to repository rahul-m21/Test_Tool..."
          curl -s -H "Authorization: token ${{ secrets.PQC_PAT_TOKEN }}" \
            https://api.github.com/repos/rahul-m21/Test_Tool | jq .name
      
          echo "Checking access to branch PQC-V2..."
          curl -s -H "Authorization: token ${{ secrets.PQC_PAT_TOKEN }}" \
            https://api.github.com/repos/rahul-m21/Test_Tool/git/refs/heads/main | jq
        shell: bash

      # Main Step: Run the PQC Assessment Action
      - name: Use PQC_Assessment Runner Action
        uses: rahul-m21/Test_Tool@main # Use the branch "PQC-V2"
        with:
          target-repo-url: ${{ github.repository }}
          token: ${{ secrets.PQC_PAT_TOKEN }}  # Pass the Personal Access Token for authentication
